<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=mask-icon href=/favicon.svg color=black><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Montserrat&family=Arvo&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=https://www.ftvkyo.me/scss/index.css><title>ftvkyo | OpenSCAD snippets</title><link href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css rel=stylesheet></head><body><script>0</script><header class=only-screen><nav><a class=logo href=/>Home
</a><a href=/project/>Projects
</a><a href=/post/>Posts
</a><a href=/about/>About</a></nav></header><main><h1>OpenSCAD snippets</h1><div class=metadata><div class=description>Some snapshots of my OpenSCAD adventures</div></div><details id=TableOfContentsDetails><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#wavy-donut>Wavy donut</a></li><li><a href=#funky-vase>Funky vase</a></li><li><a href=#double-helix-loop-with-bridges>Double helix loop with bridges</a></li><li><a href=#interpolated-extrusion>Interpolated extrusion</a></li></ul></nav></details><p>For now, the snippets are self-contained.
That implies there may be duplicates of common functions between snippets.
Even worse, the functions with the same names may work differently in different snippets.
And there may be fewer comments than desired.
You&rsquo;ve been warned <code>¯\_(ツ)_/¯</code></p><h2 id=wavy-donut>Wavy donut</h2><p><em>Just why did I do this?</em></p><figure><img src=/img/project/openscad-snippets/wavy-donut-2.webp alt="A render of the wavy donut with 2 waves"><figcaption><p>A render of the wavy donut with 2 waves</p></figcaption></figure><p>It is implemented using the <code>polyhedron()</code> OpenSCAD module.
I generate flat slices of the donut, rotate and position them in 3D using <code>pts_rotate3</code> and <code>pts_translate3</code>, and then stitch them into a loop in the <code>pts_extrude</code> module.</p><p>There are alternative methods to get roughly similar results (e.g. intersecting cylinders or cones), but they are insufficient.
Additionally, OpenSCAD&rsquo;s boolean operations with polyhedra are not very fast.
Smoothing the results with something like a Minkowski sum of the shape&rsquo;s edge and a sphere would be painfully slow, and the result still won&rsquo;t be as smooth as this.</p><p>What I really like about this one, is that it took me just a couple minutes to implement tilting of individual slices to make the waves actually &#171;bend&#187; rather than &#171;bob&#187;.
I used the fact that if <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\alpha) = cos(\alpha)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">cos</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mclose>)</span></span></span></span>, and <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\alpha)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mclose>)</span></span></span></span> is the slice &#171;bobbing&#187; function, then <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f&#x27;(\alpha) = -sin(\alpha)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0019em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7519em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>−</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mclose>)</span></span></span></span> which provides the tilt.
And then guesstimated some magic coefficients because I couldn&rsquo;t be bothered.</p><figure><img src=/img/project/openscad-snippets/wavy-donut-5.webp alt="The same wavy donut, but with 5 waves"><figcaption><p>The same wavy donut, but with 5 waves</p></figcaption></figure><details><summary>Source code of the wavy donut</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scad data-lang=scad><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>clamp</span>(<span style=color:#e06c75>v_min</span>, <span style=color:#e06c75>t</span>, <span style=color:#e06c75>v_max</span>) <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>max</span>(<span style=color:#e06c75>v_min</span>, <span style=color:#e5c07b>min</span>(<span style=color:#e06c75>t</span>, <span style=color:#e06c75>v_max</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_circle</span>(<span style=color:#e06c75>radius</span>, <span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>radius</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>radius</span> <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>0</span>, <span style=color:#98c379>&#34;&#39;radius&#39; is not a number larger than 0&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_undef</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>||</span> (<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>edges</span> <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>) , <span style=color:#98c379>&#34;&#39;edges&#39; is not a number larger than 2&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span>(<span style=color:#e06c75>edges</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>?</span> <span style=color:#e06c75>edges</span> : <span style=color:#e06c75>clamp</span>(<span style=color:#d19a66>12</span>, <span style=color:#e06c75>radius</span>, <span style=color:#d19a66>360</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>a</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#d19a66>360</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>edges</span> : <span style=color:#d19a66>359.99999</span>]) [<span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>a</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>radius</span>, <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>a</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>radius</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_vec2</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a vec is not a list of 2 elements&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>y</span>), <span style=color:#98c379>&#34;a vec component is not a number&#34;</span>)
</span></span><span style=display:flex><span>    true;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_vec3</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a vec is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a vec component is not a number&#34;</span>)
</span></span><span style=display:flex><span>    true;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_flat</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a flat is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a point in a flat is not a list of 2 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>), <span style=color:#98c379>&#34;a component of a point in a flat is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_slice</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a slice is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point in a slice is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a component of a point in a slice is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_translate2</span>(<span style=color:#e06c75>flat</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>flat</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec2</span>(<span style=color:#e06c75>t</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>) <span style=color:#e06c75>point</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_translate3</span>(<span style=color:#e06c75>slice</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>slice</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>t</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) <span style=color:#e06c75>point</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_inflate</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>flat</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>) [<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>, <span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>, <span style=color:#d19a66>0</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_rotate3</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>r</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>s</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>r</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>p0</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>s</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>let</span> (
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 1. rotate around Z
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p1</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>z</span>,
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 2. rotate around Y
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p2</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>y</span>,
</span></span><span style=display:flex><span>              <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 3. rotate around X
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p3</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>x</span>,
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        ) <span style=color:#e06c75>p3</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>pts_extrude</span>(<span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Validate the data */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that &#39;slices&#39; is a list of slices
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices&#39; is not a list of more than 2 slices&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that the first slice has enough points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices[0]&#39; is not a slice of more than 2 points&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all the slices have the same number of points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>==</span> <span style=color:#e06c75>_num_points</span>, <span style=color:#98c379>&#34;a slice has a wrong number of points&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all slices contain points of right dimensionality
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point is not a list of 3 elements&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a point component is not a number&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Generate inputs */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Collect all the points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>points</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) <span style=color:#e06c75>each</span> <span style=color:#e06c75>slice</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Define all the faces
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>faces</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>each</span> [
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// For each slice, define rectangular faces that connect it to the next slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) [
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// Two points on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>            (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// Two points on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>            ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    ] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Render */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>polyhedron</span>(<span style=color:#e06c75>points</span>, <span style=color:#e06c75>faces</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>test</span>() {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>30</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>delta_z</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>waves</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fn1</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>36</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fn2</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>360</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>slice_tilt</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> [<span style=color:#56b6c2>-</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>waves</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>delta_z</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>waves</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>2</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>3</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>slice_displacement</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>waves</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>delta_z</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>c_base</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>        <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_inflate</span>(<span style=color:#e06c75>pts_circle</span>(<span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>, <span style=color:#e06c75>fn1</span>)),
</span></span><span style=display:flex><span>            [<span style=color:#d19a66>90</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        [<span style=color:#e06c75>radius</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>cs</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>t</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>fn2</span> : <span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>fn2</span> : <span style=color:#d19a66>1</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>                <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>                    <span style=color:#e06c75>c_base</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e06c75>slice_tilt</span>(<span style=color:#e06c75>t</span>)
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                [<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>]
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>            <span style=color:#e06c75>slice_displacement</span>(<span style=color:#e06c75>t</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>pts_extrude</span>(<span style=color:#e06c75>cs</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>test</span>();
</span></span></code></pre></div></details><h2 id=funky-vase>Funky vase</h2><figure><img src=/img/project/openscad-snippets/funky-vase.webp alt="A funky vase"><figcaption><p>A funky vase</p></figcaption></figure><p>I wanted to vary <code>twist</code> and <code>scale</code> while doing <code>linear_extrude()</code>.
It&rsquo;s possible to do that in something like <a href=https://www.implicitcad.org>ImplicitCAD</a>.</p><p>In OpenSCAD, I had to assemble the end result from multiple slices, each of which had a fixed <code>twist</code> and <code>scale</code> value.
That also required correctly positioning and rotating the slices, so that they matched up with slices above and below.</p><p>Because of the boolean operations to merge the slices, this is one of the longest models to render in my collection,
especially if you increase the resolution.</p><details><summary>Source code of the funky vase</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scad data-lang=scad><span style=display:flex><span><span style=color:#7f848e>/**
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Performs linear interpolation between values `v0` and `v1`.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Parameter `t` determines the weights of `v0` and `v1`.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Its valid values are in the interval [0, 1].
</span></span></span><span style=display:flex><span><span style=color:#7f848e>*/</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>lerp</span>(<span style=color:#e06c75>v0</span>, <span style=color:#e06c75>v1</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#d19a66>1</span>) (<span style=color:#d19a66>1</span> <span style=color:#56b6c2>-</span> <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>v0</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>v1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>/**
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Calculates a single point for a quadratic Bézier curve.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    It has 3 control points.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Parameter `t` determines the extent from the start of the curve.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Its valid values are in the interval [0, 1].
</span></span></span><span style=display:flex><span><span style=color:#7f848e>*/</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_bezier2</span>(<span style=color:#e06c75>pts</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>pts</span>[<span style=color:#d19a66>0</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>1</span>], <span style=color:#e06c75>t</span>), <span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>pts</span>[<span style=color:#d19a66>1</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>2</span>], <span style=color:#e06c75>t</span>), <span style=color:#e06c75>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>/**
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Calculates a single point for a cubic Bézier curve.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    It has 4 control points.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Parameter `t` determines the extent from the start of the curve.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Its valid values are in the interval [0, 1].
</span></span></span><span style=display:flex><span><span style=color:#7f848e>*/</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_bezier3</span>(<span style=color:#e06c75>pts</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>_bezier2</span>([<span style=color:#e06c75>pts</span>[<span style=color:#d19a66>0</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>1</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>2</span>]], <span style=color:#e06c75>t</span>), <span style=color:#e06c75>_bezier2</span>([<span style=color:#e06c75>pts</span>[<span style=color:#d19a66>1</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>2</span>], <span style=color:#e06c75>pts</span>[<span style=color:#d19a66>3</span>]], <span style=color:#e06c75>t</span>), <span style=color:#e06c75>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// Height
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>h</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>120</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// Sides of the base polygon
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>f</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>6</span>;
</span></span><span style=display:flex><span><span style=color:#7f848e>// Radius of the base polygon
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>r</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>35</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// Slices
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>s</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>36</span>;
</span></span><span style=display:flex><span><span style=color:#7f848e>// Determines twist based on the slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>t</span>(<span style=color:#e06c75>sn</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>_bezier3</span>([<span style=color:#d19a66>0</span>, <span style=color:#d19a66>120</span>, <span style=color:#56b6c2>-</span><span style=color:#d19a66>180</span>, <span style=color:#d19a66>30</span>], <span style=color:#e06c75>sn</span> <span style=color:#56b6c2>/</span> (<span style=color:#e06c75>s</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>)) <span style=color:#56b6c2>/</span> <span style=color:#e06c75>s</span>;
</span></span><span style=display:flex><span><span style=color:#7f848e>// Determines scale based on the slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>e</span>(<span style=color:#e06c75>sn</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>_bezier3</span>([<span style=color:#d19a66>1</span>, <span style=color:#d19a66>2</span>, <span style=color:#d19a66>0.5</span>, <span style=color:#d19a66>1.2</span>], <span style=color:#e06c75>sn</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>s</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>__hidden__</span>() {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>12</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>E</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>0.01</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>rounden</span>(<span style=color:#e06c75>r</span>) {
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>offset</span>(<span style=color:#56b6c2>-</span> <span style=color:#e06c75>r</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>offset</span>(<span style=color:#e06c75>r</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>offset</span>(<span style=color:#56b6c2>-</span> <span style=color:#e06c75>r</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>children</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>profile</span>() {
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>circle</span>(<span style=color:#e06c75>r</span>, <span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>f</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>module</span> <span style=color:#e06c75>corners</span>(<span style=color:#e06c75>r</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> (<span style=color:#e06c75>a</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> : <span style=color:#e06c75>f</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>rotate</span>(<span style=color:#d19a66>360</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>a</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>f</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>translate</span>([<span style=color:#e06c75>r</span>, <span style=color:#d19a66>0</span>]) {
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>circle</span>(<span style=color:#e06c75>r</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>3</span>, <span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>f</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>children</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>corners</span>(<span style=color:#e06c75>r</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>corners</span>(<span style=color:#e06c75>r</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>3</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>vase</span>() {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>module</span> <span style=color:#e06c75>slice</span>(<span style=color:#e06c75>sn</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>twist</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>t</span>(<span style=color:#e06c75>sn</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>scale_start</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>e</span>(<span style=color:#e06c75>sn</span>);
</span></span><span style=display:flex><span>        <span style=color:#e06c75>scale_end</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>e</span>(<span style=color:#e06c75>sn</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>/</span> <span style=color:#e06c75>scale_start</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>scale</span>([<span style=color:#e06c75>scale_start</span>, <span style=color:#e06c75>scale_start</span>, <span style=color:#d19a66>1</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>linear_extrude</span>(<span style=color:#e06c75>h</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>s</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>E</span>, <span style=color:#e06c75>slices</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>4</span>, <span style=color:#e06c75>twist</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>twist</span>, <span style=color:#e5c07b>scale</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>scale_end</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>rounden</span>(<span style=color:#d19a66>3</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>profile</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>rotate</span>([<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#56b6c2>-</span> <span style=color:#e06c75>twist</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>translate</span>([<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#e06c75>h</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>s</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>children</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>module</span> <span style=color:#e06c75>reslice</span>(<span style=color:#e06c75>recur</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> (<span style=color:#e06c75>recur</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#e06c75>s</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>slice</span>(<span style=color:#e06c75>recur</span>)
</span></span><span style=display:flex><span>            <span style=color:#e06c75>reslice</span>(<span style=color:#e06c75>recur</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>children</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>reslice</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>vase</span>();
</span></span></code></pre></div></details><h2 id=double-helix-loop-with-bridges>Double helix loop with bridges</h2><figure><img src=/img/project/openscad-snippets/double-helix-loop-with-bridges.webp alt="The thing"><figcaption><p>The thing</p></figcaption></figure><p>This builds up on the code written for the <a href=#wavy-donut>wavy donut</a>.
There are two strands, both of which are composed of slices that are transformed in various ways.</p><p>I also tried to implement slice tilt to make the cross-section round, like I kind of did for the wavy donut.
However, I think I didn&rsquo;t fully succeed, because I was struggling to find the right formulas (considering there is tilt on 2 axis & the phase shift between two strands).
I don&rsquo;t even know if it&rsquo;s included in the following code (I think it is).
But the shape still looks cool.</p><p>The bridges are, thankfully, just regular cylinders.</p><figure><img src=/img/project/openscad-snippets/double-helix-loop-with-bridges-debug.webp alt="Here is what it looks like if I wrap it around a regular ring"><figcaption><p>Here is what it looks like if I wrap it around a regular ring</p></figcaption></figure><details><summary>Source code of the double helix loop with bridges</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scad data-lang=scad><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_vec3</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a vec is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a vec component is not a number&#34;</span>)
</span></span><span style=display:flex><span>    true;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_flat</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a flat is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a point in a flat is not a list of 2 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>), <span style=color:#98c379>&#34;a component of a point in a flat is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_slice</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a slice is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point in a slice is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a component of a point in a slice is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>clamp</span>(<span style=color:#e06c75>v_min</span>, <span style=color:#e06c75>t</span>, <span style=color:#e06c75>v_max</span>) <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>max</span>(<span style=color:#e06c75>v_min</span>, <span style=color:#e5c07b>min</span>(<span style=color:#e06c75>t</span>, <span style=color:#e06c75>v_max</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_circle</span>(<span style=color:#e06c75>radius</span>, <span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>radius</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>radius</span> <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>0</span>, <span style=color:#98c379>&#34;&#39;radius&#39; is not a number larger than 0&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_undef</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>||</span> (<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>edges</span> <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>) , <span style=color:#98c379>&#34;&#39;edges&#39; is not a number larger than 2&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span>(<span style=color:#e06c75>edges</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>?</span> <span style=color:#e06c75>edges</span> : <span style=color:#e06c75>clamp</span>(<span style=color:#d19a66>12</span>, <span style=color:#e06c75>radius</span>, <span style=color:#d19a66>360</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>a</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#d19a66>360</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>edges</span> : <span style=color:#d19a66>359.99999</span>]) [<span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>a</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>radius</span>, <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>a</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>radius</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_translate3</span>(<span style=color:#e06c75>slice</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>slice</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>t</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) <span style=color:#e06c75>point</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_inflate</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>flat</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>) [<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>, <span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>, <span style=color:#d19a66>0</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_rotate3</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>r</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>s</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>r</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>p0</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>s</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>let</span> (
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 1. rotate around Z
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p1</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>z</span>,
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 2. rotate around Y
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p2</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>y</span>,
</span></span><span style=display:flex><span>              <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 3. rotate around X
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p3</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>x</span>,
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        ) <span style=color:#e06c75>p3</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>pts_extrude</span>(<span style=color:#e06c75>slices</span>, <span style=color:#e06c75>loop</span> <span style=color:#56b6c2>=</span> true, <span style=color:#e06c75>quads</span> <span style=color:#56b6c2>=</span> true) {
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Validate the data */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that &#39;slices&#39; is a list of slices
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices&#39; is not a list of more than 2 slices&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that the first slice has enough points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices[0]&#39; is not a slice of more than 2 points&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all the slices have the same number of points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>==</span> <span style=color:#e06c75>_num_points</span>, <span style=color:#98c379>&#34;a slice has a wrong number of points&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all slices contain points of right dimensionality
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point is not a list of 3 elements&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a point component is not a number&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Generate inputs */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Collect all the points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>points</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) <span style=color:#e06c75>each</span> <span style=color:#e06c75>slice</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// If not loop, don&#39;t connect the last slice with the zeroth
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>_last_slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>loop</span> <span style=color:#56b6c2>?</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span> : <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Define all the faces
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>faces</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_last_slice</span>]) <span style=color:#e06c75>each</span> [
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// For each slice, define rectangular faces that connect it to the next slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#c678dd>if</span> (<span style=color:#e06c75>quads</span>)
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>])[
</span></span><span style=display:flex><span>                <span style=color:#7f848e>// Two points on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>each</span> [
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// One point on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// One point on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>    ]];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Render */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> (<span style=color:#e06c75>loop</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>polyhedron</span>(<span style=color:#e06c75>points</span>, <span style=color:#e06c75>faces</span>, <span style=color:#e06c75>convexity</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>);
</span></span><span style=display:flex><span>    } <span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// Add closing faces
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>face_end_1</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> : <span style=color:#e06c75>_num_points</span>]) <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#e06c75>i</span> ];
</span></span><span style=display:flex><span>        <span style=color:#e06c75>face_end_2</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>faces</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>fs</span> <span style=color:#56b6c2>=</span> [[<span style=color:#e06c75>face_end_1</span>], <span style=color:#e06c75>faces</span>, [<span style=color:#e06c75>face_end_2</span>]]) <span style=color:#e06c75>each</span> <span style=color:#e06c75>fs</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>polyhedron</span>(<span style=color:#e06c75>points</span>, <span style=color:#e06c75>faces</span>, <span style=color:#e06c75>convexity</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>double_helix</span>(
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_ring</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_twist</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thickness</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>gap</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>twists</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fn_profile</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>36</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fn_loop</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>180</span>,
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>strand_base</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>        <span style=color:#e06c75>pts_inflate</span>(<span style=color:#e06c75>pts_circle</span>(<span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>, <span style=color:#e06c75>fn_profile</span>)),
</span></span><span style=display:flex><span>        [<span style=color:#d19a66>90</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>trot</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>twists</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>module</span> <span style=color:#e06c75>strand</span>(<span style=color:#e06c75>dx</span>, <span style=color:#e06c75>dz</span>) {
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// The slice center will always be this far from the helix center
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#e06c75>init_distance</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>sqrt</span>(<span style=color:#e06c75>dx</span>^<span style=color:#d19a66>2</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>dz</span>^<span style=color:#d19a66>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// Rotation of the init_distance to achieve dx and dz
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#e06c75>init_angle</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>atan</span>(<span style=color:#e06c75>dz</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>dx</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>slice_init</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>                <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>                    <span style=color:#e06c75>s</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Guesstimation to make the crossection more round
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    [<span style=color:#56b6c2>-</span> <span style=color:#e5c07b>atan</span>(<span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>twists</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>twists</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                [<span style=color:#e06c75>init_distance</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>            [<span style=color:#d19a66>0</span>, <span style=color:#e06c75>init_angle</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>slice_transform</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>                <span style=color:#e06c75>slice_init</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>t</span>),
</span></span><span style=display:flex><span>                [<span style=color:#d19a66>0</span>, <span style=color:#e06c75>trot</span>(<span style=color:#e06c75>t</span>), <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>            [<span style=color:#e06c75>radius_ring</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>strand_slices</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>t</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>fn_loop</span> : <span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>fn_loop</span> : <span style=color:#d19a66>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>                <span style=color:#e06c75>slice_transform</span>(<span style=color:#e06c75>strand_base</span>, <span style=color:#e06c75>t</span>),
</span></span><span style=display:flex><span>                [<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>pts_extrude</span>(<span style=color:#e06c75>strand_slices</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>strand</span>(<span style=color:#e06c75>radius_twist</span>, (<span style=color:#e06c75>gap</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>thickness</span>) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>strand</span>(<span style=color:#e06c75>radius_twist</span>, <span style=color:#56b6c2>-</span> (<span style=color:#e06c75>gap</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>thickness</span>) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>double_helix_bridges</span>(
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_ring</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_twist</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thickness</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>gap</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>twists</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>steps</span>
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>16</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>module</span> <span style=color:#e06c75>bridge</span>() {
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>cylinder</span>(<span style=color:#e06c75>gap</span>, <span style=color:#e06c75>r</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>, <span style=color:#e06c75>center</span> <span style=color:#56b6c2>=</span> true);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>t</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>steps</span> : <span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>steps</span> : <span style=color:#d19a66>1</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>rotate</span>([<span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>, <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>translate</span>([<span style=color:#e06c75>radius_ring</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>rotate</span>([<span style=color:#d19a66>0</span>, <span style=color:#e06c75>twists</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>])
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>translate</span>([<span style=color:#e06c75>radius_twist</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>])
</span></span><span style=display:flex><span>            <span style=color:#e06c75>bridge</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>/* Parameters */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>radius_ring</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>25</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>radius_twist</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>2</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>gap</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>4</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>twists</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>6</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>bridges</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>72</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>thickness_helix</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>3</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>thickness_bridge</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>/* Render */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>double_helix</span>(
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_ring</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>radius_ring</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_twist</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>radius_twist</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>thickness_helix</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>gap</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>gap</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>twists</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>twists</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fn_loop</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>360</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>double_helix_bridges</span>(
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_ring</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>radius_ring</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>radius_twist</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>radius_twist</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thickness</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>thickness_bridge</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>gap</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>gap</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>thickness_helix</span> <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>twists</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>twists</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>steps</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>bridges</span>
</span></span><span style=display:flex><span>);
</span></span></code></pre></div></details><h2 id=interpolated-extrusion>Interpolated extrusion</h2><figure><img src=/img/project/openscad-snippets/interpolate-extrude.webp></figure><p>This shows how to extrude while interpolating between two outlines.
It reuses the <code>pts_extrude</code> module from previous examples.
The difference is in how individual slices of the extrusion are generated.</p><p>There are functions <code>f_circle</code> and <code>f_hexagon</code>, they take a parameter <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">t \in [0, 1]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6542em;vertical-align:-.0391em></span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>]</span></span></span></span> and return points of their outline.
Each resulting slice is an interpolation of the slices that come from those functions.
See function <code>f_slice</code> for a complete list of transformations applied to the slices.</p><p>I also used an easing function for interpolation to make the transition away from the circle more smooth.
For fun, there is also an added twist interpolated with a cubic ease-in-out function.</p><details><summary>Source code of the interpolated extrusion</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scad data-lang=scad><span style=display:flex><span><span style=color:#7f848e>/**
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Performs linear interpolation between values `v0` and `v1`.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Parameter `t` determines the weights of `v0` and `v1`.
</span></span></span><span style=display:flex><span><span style=color:#7f848e>    Its valid values are in the interval [0, 1].
</span></span></span><span style=display:flex><span><span style=color:#7f848e>*/</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>lerp</span>(<span style=color:#e06c75>v0</span>, <span style=color:#e06c75>v1</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#d19a66>1</span>) (<span style=color:#d19a66>1</span> <span style=color:#56b6c2>-</span> <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>v0</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>v1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_vec2</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a vec is not a list of 2 elements&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>y</span>), <span style=color:#98c379>&#34;a vec component is not a number&#34;</span>)
</span></span><span style=display:flex><span>    true;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_vec3</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>vec</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a vec is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>vec</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a vec component is not a number&#34;</span>)
</span></span><span style=display:flex><span>    true;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_flat</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a flat is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a point in a flat is not a list of 2 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>), <span style=color:#98c379>&#34;a component of a point in a flat is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>_assert_slice</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;a slice is not a list of more than 2 points&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>is_list</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point in a slice is not a list of 3 elements&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a component of a point in a slice is not a number&#34;</span>)
</span></span><span style=display:flex><span>        true
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_f</span>(<span style=color:#e06c75>f</span>, <span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_function</span>(<span style=color:#e06c75>f</span>), <span style=color:#98c379>&#34;&#39;f&#39; is not a function&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>edges</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>edges</span> <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;edges&#39; is not a number greater than 2&#34;</span>)
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>e</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> : <span style=color:#d19a66>1</span> : <span style=color:#e06c75>edges</span>]) <span style=color:#e06c75>f</span>(<span style=color:#e06c75>e</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>edges</span>) ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_f_interp</span>(<span style=color:#e06c75>f1</span>, <span style=color:#e06c75>f2</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#d19a66>1</span>, <span style=color:#98c379>&#34;&#39;t&#39; is not a number between 0 and 1&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span> (
</span></span><span style=display:flex><span>        <span style=color:#e06c75>s1</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_f</span>(<span style=color:#e06c75>f1</span>, <span style=color:#e06c75>$fn</span>),
</span></span><span style=display:flex><span>        <span style=color:#e06c75>s2</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>pts_f</span>(<span style=color:#e06c75>f2</span>, <span style=color:#e06c75>$fn</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>s1</span>[<span style=color:#e06c75>i</span>], <span style=color:#e06c75>s2</span>[<span style=color:#e06c75>i</span>], <span style=color:#e06c75>t</span>) ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_scale2</span>(<span style=color:#e06c75>slice</span>, <span style=color:#e06c75>s</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>slice</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec2</span>(<span style=color:#e06c75>s</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>p</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) [<span style=color:#e06c75>p</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>s</span>.<span style=color:#e06c75>x</span>, <span style=color:#e06c75>p</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>s</span>.<span style=color:#e06c75>y</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_rotate2</span>(<span style=color:#e06c75>flat</span>, <span style=color:#e06c75>r</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>flat</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>r</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>p</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>) [<span style=color:#e06c75>p</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>), <span style=color:#e06c75>p</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>)] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_translate3</span>(<span style=color:#e06c75>slice</span>, <span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>slice</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>t</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) <span style=color:#e06c75>point</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>t</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_rotate3</span>(<span style=color:#e06c75>s</span>, <span style=color:#e06c75>r</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_slice</span>(<span style=color:#e06c75>s</span>))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_vec3</span>(<span style=color:#e06c75>r</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>p0</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>s</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>let</span> (
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 1. rotate around Z
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p1</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>z</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p0</span>.<span style=color:#e06c75>z</span>,
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 2. rotate around Y
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p2</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>y</span>,
</span></span><span style=display:flex><span>              <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>x</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p1</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>y</span>),
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 3. rotate around X
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#e06c75>p3</span> <span style=color:#56b6c2>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>x</span>,
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>-</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>                <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>y</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>p2</span>.<span style=color:#e06c75>z</span> <span style=color:#56b6c2>*</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>r</span>.<span style=color:#e06c75>x</span>),
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        ) <span style=color:#e06c75>p3</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>pts_inflate</span>(<span style=color:#e06c75>flat</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>_assert_flat</span>(<span style=color:#e06c75>flat</span>))
</span></span><span style=display:flex><span>    [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>flat</span>) [<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>, <span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>, <span style=color:#d19a66>0</span>] ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>module</span> <span style=color:#e06c75>pts_extrude</span>(<span style=color:#e06c75>slices</span>, <span style=color:#e06c75>loop</span> <span style=color:#56b6c2>=</span> true, <span style=color:#e06c75>quads</span> <span style=color:#56b6c2>=</span> true) {
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Validate the data */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that &#39;slices&#39; is a list of slices
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices&#39; is not a list of more than 2 slices&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that the first slice has enough points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]) <span style=color:#56b6c2>&gt;</span> <span style=color:#d19a66>2</span>, <span style=color:#98c379>&#34;&#39;slices[0]&#39; is not a slice of more than 2 points&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slices</span>[<span style=color:#d19a66>0</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all the slices have the same number of points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>slice</span>) <span style=color:#56b6c2>==</span> <span style=color:#e06c75>_num_points</span>, <span style=color:#98c379>&#34;a slice has a wrong number of points&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Check that all slices contain points of right dimensionality
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> (<span style=color:#e06c75>point</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slice</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_list</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e5c07b>len</span>(<span style=color:#e06c75>point</span>) <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span>, <span style=color:#98c379>&#34;a point is not a list of 3 elements&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>x</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>y</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>point</span>.<span style=color:#e06c75>z</span>), <span style=color:#98c379>&#34;a point component is not a number&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Generate inputs */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Collect all the points
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>points</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>slices</span>) <span style=color:#e06c75>each</span> <span style=color:#e06c75>slice</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// If not loop, don&#39;t connect the last slice with the zeroth
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>_last_slice</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>loop</span> <span style=color:#56b6c2>?</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span> : <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// Define all the faces
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>faces</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_last_slice</span>]) <span style=color:#e06c75>each</span> [
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// For each slice, define rectangular faces that connect it to the next slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#c678dd>if</span> (<span style=color:#e06c75>quads</span>)
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>])[
</span></span><span style=display:flex><span>                <span style=color:#7f848e>// Two points on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>each</span> [
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// One point on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// One point on the current slice
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    (<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7f848e>// Two points on the next slice (possibly zeroth)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_points</span>,
</span></span><span style=display:flex><span>                    ((<span style=color:#e06c75>slice</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>%</span> <span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>) <span style=color:#56b6c2>+</span> <span style=color:#e06c75>i</span>,
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>    ]];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>/* Render */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> (<span style=color:#e06c75>loop</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>polyhedron</span>(<span style=color:#e06c75>points</span>, <span style=color:#e06c75>faces</span>, <span style=color:#e06c75>convexity</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>);
</span></span><span style=display:flex><span>    } <span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// Add closing faces
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>face_end_1</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>1</span> : <span style=color:#e06c75>_num_points</span>]) <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#e06c75>i</span> ];
</span></span><span style=display:flex><span>        <span style=color:#e06c75>face_end_2</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#e06c75>_num_points</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>i</span> <span style=color:#56b6c2>+</span> (<span style=color:#e06c75>_num_slices</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>_num_points</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>faces</span> <span style=color:#56b6c2>=</span> [ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>fs</span> <span style=color:#56b6c2>=</span> [[<span style=color:#e06c75>face_end_1</span>], <span style=color:#e06c75>faces</span>, [<span style=color:#e06c75>face_end_2</span>]]) <span style=color:#e06c75>each</span> <span style=color:#e06c75>fs</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>polyhedron</span>(<span style=color:#e06c75>points</span>, <span style=color:#e06c75>faces</span>, <span style=color:#e06c75>convexity</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// Credit: https://easings.net/
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>ease_in_sine</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span> <span style=color:#d19a66>1</span> <span style=color:#56b6c2>-</span> <span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>90</span>);
</span></span><span style=display:flex><span><span style=color:#c678dd>function</span> <span style=color:#61afef;font-weight:700>ease_in_out_cubic</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>=</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#d19a66>0.5</span>
</span></span><span style=display:flex><span>    <span style=color:#56b6c2>?</span> <span style=color:#d19a66>4</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span>
</span></span><span style=display:flex><span>    : <span style=color:#d19a66>1</span> <span style=color:#56b6c2>-</span> <span style=color:#e5c07b>pow</span>(<span style=color:#56b6c2>-</span><span style=color:#d19a66>2</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>2</span>, <span style=color:#d19a66>3</span>) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>radius</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>10</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>bend_radius</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>25</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>bend_angle</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>45</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>twist</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>30</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$fn</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>120</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>f_circle</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>) [<span style=color:#e5c07b>cos</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>), <span style=color:#e5c07b>sin</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>360</span>)];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>f_hexagon_point</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>function</span>(<span style=color:#e06c75>n</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>n</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>n</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#d19a66>0</span>, <span style=color:#98c379>&#34;&#39;n&#39; is not a number greater than 0&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span> (<span style=color:#e06c75>n</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>n</span> <span style=color:#56b6c2>%</span> <span style=color:#d19a66>6</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span> (<span style=color:#e06c75>r</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>sqrt</span>(<span style=color:#d19a66>3</span>) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>?</span> [<span style=color:#d19a66>1</span>, <span style=color:#d19a66>0</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>1</span> <span style=color:#56b6c2>?</span> [<span style=color:#d19a66>1</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>, <span style=color:#e06c75>r</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>2</span> <span style=color:#56b6c2>?</span> [<span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>, <span style=color:#e06c75>r</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>3</span> <span style=color:#56b6c2>?</span> [<span style=color:#56b6c2>-</span><span style=color:#d19a66>1</span> , <span style=color:#d19a66>0</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>4</span> <span style=color:#56b6c2>?</span> [<span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>, <span style=color:#56b6c2>-</span> <span style=color:#e06c75>r</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e06c75>n</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>5</span> <span style=color:#56b6c2>?</span> [<span style=color:#d19a66>1</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>, <span style=color:#56b6c2>-</span> <span style=color:#e06c75>r</span>] :
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>undef</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>f_hexagon</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>is_num</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>&lt;=</span> <span style=color:#d19a66>1</span>, <span style=color:#98c379>&#34;&#39;t&#39; is not a number between 0 and 1&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>let</span> (
</span></span><span style=display:flex><span>        <span style=color:#e06c75>r</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>sqrt</span>(<span style=color:#d19a66>3</span>) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#e06c75>sector</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>floor</span>(<span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>6</span>),
</span></span><span style=display:flex><span>        <span style=color:#e06c75>sector_t</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>t</span> <span style=color:#56b6c2>*</span> <span style=color:#d19a66>6</span> <span style=color:#56b6c2>-</span> <span style=color:#e06c75>sector</span>,
</span></span><span style=display:flex><span>        <span style=color:#e06c75>sector_point_a</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>f_hexagon_point</span>(<span style=color:#e06c75>sector</span>),
</span></span><span style=display:flex><span>        <span style=color:#e06c75>sector_point_b</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>f_hexagon_point</span>(<span style=color:#e06c75>sector</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>)
</span></span><span style=display:flex><span>    ) <span style=color:#e06c75>lerp</span>(<span style=color:#e06c75>sector_point_a</span>, <span style=color:#e06c75>sector_point_b</span>, <span style=color:#e06c75>sector_t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>f_slice</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>, <span style=color:#e06c75>ease_interp</span>, <span style=color:#e06c75>ease_twist</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>        <span style=color:#e06c75>pts_rotate3</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>pts_translate3</span>(
</span></span><span style=display:flex><span>                <span style=color:#e06c75>pts_inflate</span>(
</span></span><span style=display:flex><span>                    <span style=color:#e06c75>pts_rotate2</span>(
</span></span><span style=display:flex><span>                        <span style=color:#e06c75>pts_scale2</span>(
</span></span><span style=display:flex><span>                            <span style=color:#e06c75>pts_f_interp</span>(
</span></span><span style=display:flex><span>                                <span style=color:#e06c75>f_circle</span>,
</span></span><span style=display:flex><span>                                <span style=color:#e06c75>f_hexagon</span>,
</span></span><span style=display:flex><span>                                <span style=color:#e06c75>ease_interp</span>(<span style=color:#e06c75>t</span>)
</span></span><span style=display:flex><span>                            ),
</span></span><span style=display:flex><span>                            [<span style=color:#e06c75>radius</span>, <span style=color:#e06c75>radius</span>]
</span></span><span style=display:flex><span>                        ),
</span></span><span style=display:flex><span>                        <span style=color:#e06c75>ease_twist</span>(<span style=color:#e06c75>t</span>) <span style=color:#56b6c2>*</span> <span style=color:#e06c75>twist</span>
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                [<span style=color:#56b6c2>-</span><span style=color:#e06c75>bend_radius</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>            [<span style=color:#d19a66>0</span>, <span style=color:#e06c75>bend_angle</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>t</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        [<span style=color:#e06c75>bend_radius</span>, <span style=color:#d19a66>0</span>, <span style=color:#d19a66>0</span>]
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>f_slice_eased</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>) <span style=color:#e06c75>f_slice</span>(<span style=color:#e06c75>t</span>, <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>) <span style=color:#e06c75>ease_in_sine</span>(<span style=color:#e06c75>t</span>), <span style=color:#c678dd>function</span>(<span style=color:#e06c75>t</span>) <span style=color:#e06c75>ease_in_out_cubic</span>(<span style=color:#e06c75>t</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>pts_extrude</span>([ <span style=color:#c678dd>for</span> (<span style=color:#e06c75>t</span> <span style=color:#56b6c2>=</span> [<span style=color:#d19a66>0</span> : <span style=color:#d19a66>1</span> <span style=color:#56b6c2>/</span> <span style=color:#e06c75>bend_angle</span> : <span style=color:#d19a66>1</span>]) <span style=color:#e06c75>f_slice_eased</span>(<span style=color:#e06c75>t</span>) ], <span style=color:#e06c75>loop</span> <span style=color:#56b6c2>=</span> false);
</span></span></code></pre></div></details></main><footer class=only-screen>© Rei</footer></body></html>